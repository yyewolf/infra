apiVersion: apps/v1
kind: Deployment
metadata:
  name: roundcube
  labels:
    app: roundcube
spec:
  replicas: 1
  selector:
    matchLabels:
      app: roundcube
  template:
    metadata:
      labels:
        app: roundcube
    spec:
      containers:
        - name: roundcube
          image: roundcube/roundcubemail:latest@sha256:b5109f2e26f8a3451a82b068211f4c43c1057cf36b8476b7a8c4a224a6cb47df
          ports:
            - containerPort: 80
          envFrom:
            - secretRef:
                name: roundcube-env
          env:
            - name: ROUNDCUBEMAIL_DEFAULT_HOST
              value: "ssl://mail.yewolf.fr"
            - name: ROUNDCUBEMAIL_DEFAULT_PORT
              value: "993"
            - name: ROUNDCUBEMAIL_SMTP_SERVER
              value: "tls://mail.yewolf.fr"
            - name: ROUNDCUBEMAIL_SMTP_PORT
              value: "587"
            - name: ROUNDCUBEMAIL_SMTP_USER
              value: "%u"
            - name: ROUNDCUBEMAIL_SMTP_PASS
              value: "%p"
            - name: ROUNDCUBEMAIL_DB_DSNW
          resources:
            requests:
              cpu: 0m
              memory: 0Mi
            limits:
              cpu: 1
              memory: 500Mi
