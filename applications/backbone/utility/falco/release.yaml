apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: falco
spec:
  interval: 30m
  targetNamespace: falco
  releaseName: falco
  chart:
    spec:
      chart: falco
      version: 7.0.0
      sourceRef:
        kind: HelmRepository
        name: falco
  values:
    image:
      registry: mirror.gcr.io
    tolerations:
    - operator: Exists
    falcoctl:
      image:
        registry: mirror.gcr.io
    serviceMonitor:
      create: true
    metrics:
      enabled: true
      includeEmptyValues: true
      interval: 30s
    grafana:
      dashboards:
        enabled: true
    collectors:
      kubernetes:
        enabled: true
    falco:
      capture:
        enabled: true
      json_output: true
      http_output:
        enabled: true
        url: "sidekick-falcosidekick.falco.svc:2801"
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: sidekick
spec:
  interval: 30m
  targetNamespace: falco
  releaseName: sidekick
  chart:
    spec:
      chart: falcosidekick
      version: 0.11.1
      sourceRef:
        kind: HelmRepository
        name: falco
  values:
    image:
      registry: mirror.gcr.io
    prometheusRules:
      enabled: true
    serviceMonitor:
      enabled: true
    grafana:
      dashboards:
        enabled: true
    config:
      discord:
        webhookurl: ""
  valuesFrom:
  - kind: Secret
    name: alerting
    valuesKey: discordWebhookURL
    targetPath: config.discord.webhookurl
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: k8s-metacollector
spec:
  interval: 30m
  targetNamespace: falco
  releaseName: k8s-metacollector
  chart:
    spec:
      chart: k8s-metacollector
      version: 0.1.10
      sourceRef:
        kind: HelmRepository
        name: falco
  values:
    image:
      registry: mirror.gcr.io
