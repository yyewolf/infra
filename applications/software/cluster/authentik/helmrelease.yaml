apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: authentik 
  namespace: authentik 
spec:
  interval: 5m
  chart:
    spec:
      chart: authentik 
      version: 2025.12.3
      sourceRef:
        kind: HelmRepository
        name: authentik
        namespace: authentik
  values:
    authentik:
      error_reporting:
        enabled: false
      postgresql:
        name: "authentik"
      email:
        use_tls: true
    worker:
      replicas: 2
    server:
      replicas: 2
      route:
        main:
          enabled: true
          hostnames:
            - "auth.yewolf.fr"
          parentRefs:
            - name: kgateway
              namespace: kgateway
              sectionName: https
  valuesFrom:
  - kind: Secret
    name: authentik-secret
    valuesKey: secretKey
    targetPath: authentik.secret_key
  - kind: Secret
    name: authentik-secret
    valuesKey: databaseHost
    targetPath: authentik.postgresql.host
  - kind: Secret
    name: authentik-secret
    valuesKey: databaseUser
    targetPath: authentik.postgresql.user
  - kind: Secret
    name: authentik-secret
    valuesKey: databasePassword
    targetPath: authentik.postgresql.password
  - kind: Secret
    name: authentik-secret
    valuesKey: emailHost
    targetPath: authentik.email.host
  - kind: Secret
    name: authentik-secret
    valuesKey: emailFrom
    targetPath: authentik.email.from
  - kind: Secret
    name: authentik-secret
    valuesKey: emailFrom
    targetPath: authentik.email.username
  - kind: Secret
    name: authentik-secret
    valuesKey: emailPassword
    targetPath: authentik.email.password
